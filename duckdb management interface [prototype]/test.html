<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulaire de Mise à Jour</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .update-simple-display-buttons {
            margin-bottom: 20px;
        }
        .update-simple-display-btn {
            margin-right: 10px;
            padding: 8px 12px;
            border: 1px solid #ccc;
            background-color: #f8f8f8;
            cursor: pointer;
        }
        #fields-container ul {
            list-style: none;
            padding: 0;
        }
        #fields-container li {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        input[type="text"] {
            margin-left: 10px;
            display: none;
        }
        .validation-buttons {
            margin-top: 10px;
        }
    </style>
</head>
<body>

    <h2>Sélectionnez la table à mettre à jour</h2>
    <div class="update-simple-display-buttons">
        <button class="update-simple-display-btn" id="update-evaluation-results-btn">evaluation_results</button>
        <button class="update-simple-display-btn" id="update-evaluation-runs-btn">evaluation_runs</button>
        <button class="update-simple-display-btn" id="update-task-configs-btn">task_configs</button>
        <button class="update-simple-display-btn" id="update-task-metrics-btn">task_metrics</button>
        <button class="update-simple-display-btn" id="update-task-summaries-btn">tasks_summaries</button>
        <button class="update-simple-display-btn" id="update-general-summary-btn">general_summary</button>
    </div>

    <div id="fields-container"></div>

    <div class="validation-buttons">
        <button id="toggle-selection-btn">Tout sélectionner</button>
        <button id="validate-btn">Valider</button>
    </div>

    <script>
        const tableMapping = {
            "update-evaluation-runs-btn": "Table \"evaluation_runs\"",
            "update-task-configs-btn": "Table \"task_configs\"",
            "update-task-metrics-btn": "Table \"task_metrics\"",
            "update-evaluation-results-btn": "Table \"tasks_evaluation_results\"",
            "update-task-summaries-btn": "Table \"tasks_summaries\"",
            "update-general-summary-btn": "Table \"general_summary\""
        };

        const tableColumns = {
            "Table \"evaluation_runs\"": [
                "run_id", "model_name", "num_fewshot_seeds", "override_batch_size", 
                "max_samples", "job_id", "start_time", "end_time", "total_evaluation_time", 
                "model_sha", "model_dtype", "model_size", "lighteval_sha"
            ],
            "Table \"task_configs\"": [
                "task_id", "task_base_name", "prompt_function", "hf_repo", 
                "hf_subset", "hf_revision", "hf_filter", "trust_dataset", 
                "few_shots_split", "few_shots_select", "generation_size", 
                "generation_grammar", "output_regex", "num_samples", 
                "original_num_docs", "effective_num_docs", 
                "must_remove_duplicate_docs", "version", "frozen"
            ],
            "Table \"task_metrics\"": [
                "metric_id", "metric_name", "higher_is_better", "category", 
                "use_case", "sample_level_fn", "corpus_level_fn"
            ],
            "Table \"tasks_evaluation_results\"": [
                "run_id", "task_id", "em", "em_stderr", "qem", 
                "qem_stderr", "pem", "pem_stderr", "pqem", "pqem_stderr"
            ],
            "Table \"tasks_summaries\"": [
                "run_id", "task_id", "truncated", "non_truncated", 
                "padded", "non_padded", "effective_few_shots", 
                "num_truncated_few_shots"
            ],
            "Table \"general_summary\"": [
                "run_id", "truncated", "non_truncated", 
                "padded", "non_padded", "num_truncated_few_shots"
            ]
        };

        document.querySelectorAll(".update-simple-display-btn").forEach(button => {
            button.addEventListener("click", function () {
                const tableName = tableMapping[this.id];
                if (tableName) {
                    displayFields(tableName);
                }
            });
        });

        function displayFields(tableName) {
            const fieldsContainer = document.getElementById("fields-container");
            fieldsContainer.innerHTML = "";

            if (tableColumns[tableName]) {
                const fieldsList = document.createElement("ul");

                tableColumns[tableName].forEach(column => {
                    const listItem = document.createElement("li");

                    const checkbox = document.createElement("input");
                    checkbox.type = "checkbox";
                    checkbox.className = "field-checkbox";
                    checkbox.style.marginRight = "10px";

                    const label = document.createElement("label");
                    label.textContent = column;
                    label.style.marginRight = "10px";

                    const input = document.createElement("input");
                    input.type = "text";
                    input.className = "field-input";
                    input.style.display = "none";
                    input.style.marginLeft = "10px";

                    checkbox.addEventListener("change", function () {
                        input.style.display = this.checked ? "inline-block" : "none";
                    });

                    listItem.appendChild(checkbox);
                    listItem.appendChild(label);
                    listItem.appendChild(input);
                    fieldsList.appendChild(listItem);
                });

                fieldsContainer.appendChild(fieldsList);
            }
        }

        // Bouton pour basculer entre sélectionner et désélectionner toutes les checkboxes
        let allSelected = false;
        document.getElementById("toggle-selection-btn").addEventListener("click", function () {
            allSelected = !allSelected;
            document.querySelectorAll(".field-checkbox").forEach(checkbox => {
                checkbox.checked = allSelected;
                checkbox.dispatchEvent(new Event("change"));
            });
            this.textContent = allSelected ? "Tout désélectionner" : "Tout sélectionner";
        });

        // Bouton pour valider et masquer tout sauf un message de récupération
        document.getElementById("validate-btn").addEventListener("click", function () {
            const fieldsContainer = document.getElementById("fields-container");
            fieldsContainer.innerHTML = "<p>Les valeurs sélectionnées sont en cours de traitement...</p>";
            // Ici, vous pouvez ajouter le code pour récupérer et envoyer les données
            console.log("Données sélectionnées prêtes pour traitement.");
        });
    </script>

</body>
</html>